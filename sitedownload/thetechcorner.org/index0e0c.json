{"id":525,"date":"2021-12-02T12:22:10","date_gmt":"2021-12-02T12:22:10","guid":{"rendered":"https:\/\/thetechcorner.org\/?p=525"},"modified":"2022-01-04T09:30:46","modified_gmt":"2022-01-04T09:30:46","slug":"setting-up-a-log-rotate-utility-in-linux","status":"publish","type":"post","link":"https:\/\/thetechcorner.org\/?p=525","title":{"rendered":"Setting up a log rotate utility in Linux"},"content":{"rendered":"\n<p>Arguably, one of the most used Linux directories is <strong>\/var\/log<\/strong>. Most of the services are logging all of the info into the logs in this directory. Administrators are using these logs <strong>to determine problems when troubleshooting the system<\/strong> or service.<\/p>\n\n\n\n<p>I&#8217;ll use Raspbian OS just because I use it in most of my guides, so why not again.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<p>We can see some of the content of my \/var\/log directory below:<\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"550\" height=\"382\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-2.png?resize=550%2C382&#038;ssl=1\" alt=\"\" class=\"wp-image-528\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-2.png?w=550&amp;ssl=1 550w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-2.png?resize=300%2C208&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-2.png?resize=24%2C17&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-2.png?resize=36%2C25&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-2.png?resize=48%2C33&amp;ssl=1 48w\" sizes=\"(max-width: 550px) 100vw, 550px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>We can see that some of the files end with a <strong>.gz<\/strong> extension, some of them have<strong> log<\/strong> in the name and some of them are combinations. They have one in common, and that is that they are logs. <\/p>\n\n\n\n<p>For the purpose of not filling up the whole directory space, they are eventually divided and can be gziped aka they are being <strong>rotated<\/strong>.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<p><strong>Phrase rotated comes from a utility named Logrotate which whole purpose is to make this job of dividing files into smaller ones and gziping them up much easier. <\/strong><\/p>\n\n\n\n<p><\/p>\n\n\n\n<h3>Installing Logrorate <\/h3>\n\n\n\n<p>Depending on your package manager there are different ways to install this utility. In my case I&#8217;ll use Raspbian which is Debian based and comes with APT package manager<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\"><strong>sudo apt-get install logrotate<\/strong><\/pre>\n\n\n\n<p><\/p>\n<\/div><\/div>\n\n\n\n<h3>Configurating Logrotate<\/h3>\n\n\n\n<p>Logrotate is very  useful and all-around tool in which we can configure the parameters of how the log are going to be rotated.<\/p>\n\n\n\n<p>We can configure these settings by creating a text file inside the \/etc\/logrotate.d directory. To do that, we type: <\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">sudo <strong>nano \/etc\/logrotate.d\/apache2.conf<\/strong><\/pre>\n\n\n\n<p><\/p>\n<\/div><\/div>\n\n\n\n<p>And inside these file paste following content <\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">\/var\/log\/apache2\/* {\n    weekly\n    rotate 3\n    size 10M\n    compress\n    delaycompress\n}<\/pre>\n\n\n\n<p><\/p>\n<\/div><\/div>\n\n\n\n<p>There are much more options that can be configured, you can just google them or use man logrotate<\/p>\n\n\n\n<p>Let&#8217;s get over each line and explain it&#8217;s purpose:<\/p>\n\n\n\n<ul><li><strong>weekly <\/strong>: as the name suggest, it means that logrotate will rotate the logs every week<ul><li>we can also use value : daily, monthly<\/li><\/ul><\/li><li><strong>rotate 3<\/strong> : implies that only 3 of the logs are going to be kept, thus older files than 3 are going to be deleted<\/li><li><strong>size=10<\/strong> : sets the minimal size of the logs to be 10M<\/li><li><strong>compress<\/strong> : implies we want the logs to be gziped or compress by any other method<\/li><li><strong>delaycompress<\/strong> : implies that we want the recent logs uncompressed until the next rotation cycle<\/li><\/ul>\n\n\n\n<p><\/p>\n\n\n\n<p>Let&#8217;s try out these settings by forcing logrotate to rotate logs now with this command:<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">logrotate -d \/etc\/logrotate.d\/apache2.conf<\/pre>\n<\/div><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>Alright, let&#8217;s try adding some additional settings to better understand this:<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\"> \/var\/log\/apache2\/* { \n    weekly\n    create 0644 root root\n    rotate 4\n    size 5m\n    datetext\n    dateformat -%d%m%Y\n    notifempty\n    mail filip@thetechcorner.org  \n}<\/pre>\n\n\n\n<p><\/p>\n<\/div><\/div>\n\n\n\n<p>As you can see we have changed a few things. <strong>The log will now not by rotated, it&#8217;s just going to be moved and renamed to time and date when it reaches a 5M size<\/strong>. <strong>The mail log file will get new permission, which we set to 0644 with a root owner. And finally, when the number of logs reaches 5, the oldest one will be sent to the configured email address. <\/strong><\/p>\n\n\n\n<p><\/p>\n\n\n\n<h3>Cron<\/h3>\n\n\n\n<p>When we install logrotate utility by default, logrotate will create a file named logrotate inside \/etc\/cron.daily which will be executed daily at <strong>6:25 am<\/strong>. You can check this by listing a content of this folder.<\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"457\" height=\"183\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-3.png?resize=457%2C183&#038;ssl=1\" alt=\"\" class=\"wp-image-529\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-3.png?w=457&amp;ssl=1 457w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-3.png?resize=300%2C120&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-3.png?resize=24%2C10&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-3.png?resize=36%2C14&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/image-3.png?resize=48%2C19&amp;ssl=1 48w\" sizes=\"(max-width: 457px) 100vw, 457px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n","protected":false},"excerpt":{"rendered":"<p>Arguably, one of the most used Linux directories is \/var\/log. Most of the services are [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":531,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"nf_dc_page":"","om_disable_all_campaigns":false,"_mi_skip_tracking":false},"categories":[208],"tags":[212,213,114],"jetpack_featured_media_url":"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2021\/12\/linux-essentialss-logrotate.png?fit=1280%2C720&ssl=1","_links":{"self":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/525"}],"collection":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=525"}],"version-history":[{"count":3,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/525\/revisions"}],"predecessor-version":[{"id":653,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/525\/revisions\/653"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/media\/531"}],"wp:attachment":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=525"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=525"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=525"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}