{"id":1335,"date":"2022-03-02T16:13:00","date_gmt":"2022-03-02T16:13:00","guid":{"rendered":"https:\/\/thetechcorner.org\/?p=1335"},"modified":"2022-03-01T09:01:25","modified_gmt":"2022-03-01T09:01:25","slug":"configure-key-based-authentication-for-ssh","status":"publish","type":"post","link":"https:\/\/thetechcorner.org\/?p=1335","title":{"rendered":"Configure key-based authentication for SSH"},"content":{"rendered":"\n<p>OpenSSH server supports various authentication options. The two most popular are<\/p>\n\n\n\n<ol><li>Passwords based authentication<\/li><li>Public key based authentication. It&#8217;s an alternative security method to using passwords.<\/li><\/ol>\n\n\n\n<p><\/p>\n\n\n\n<h2 id=\"how-do-ssh-keys-work\">How Do SSH Keys Work?<\/h2>\n\n\n\n<p>An SSH server can authenticate clients using a variety of different methods. The most basic of these is password authentication, which is easy to use, but not the most secure.<\/p>\n\n\n\n<p>Although passwords are sent to the server securely, they are generally not complex or long enough to be resistant to repeated, persistent attackers. Modern processing power combined with automated scripts make brute-forcing a password-protected account very possible.<\/p>\n\n\n\n<p>SSH keys prove to be a reliable and secure alternative.<\/p>\n\n\n\n<p>SSH key pairs are two cryptographically secure keys that can be used to authenticate a client to an SSH server. Each key pair consists of a public key and a private key.<\/p>\n\n\n\n<p>The private key is retained by the client and should be kept absolutely secret. Any compromise of the private key will allow the attacker to log into servers that are configured with the associated public key without additional authentication. As an additional precaution, the key can be encrypted on disk with a passphrase.<\/p>\n\n\n\n<p>The associated public key can be shared freely without any negative consequences. The public key can be used to encrypt messages that&nbsp;<strong>only<\/strong>&nbsp;the private key can decrypt. This property is employed as a way of authenticating using the key pair.<\/p>\n\n\n\n<p>The public key is uploaded to a remote server that you want to be able to log into with SSH. The key is added to a special file within the user account you will be logging into called&nbsp;<code>~\/.ssh\/authorized_keys<\/code>.<\/p>\n\n\n\n<p>When a client attempts to authenticate using SSH keys, the server can test the client on whether they are in possession of the private key. If the client can prove that it owns the private key, a shell session is spawned or the requested command is executed.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<p><\/p>\n\n\n\n<h3> 1. Create SSH Keys<\/h3>\n\n\n\n<p>As a first thing, we need to generate the RSA key pair. To do that, we use the tool ssk-keygen. Simply type <\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">ssh-keygen<\/pre>\n<\/div><\/div>\n\n\n\n<p>You will be prompted be few questions like, where do you want to store key, for that we use default option. And another question about the passphrase. This is an optional passphrase that can be used to encrypt the private key file on disk. But why would we use passphrase if it&#8217;s not mandatory? <\/p>\n\n\n\n<ul><li>The private SSH key, is never exposed on the network. The passphrase is only used to decrypt the key on the local machine. This means that network-based brute forcing will not be possible against the passphrase.<\/li><li>The private key is kept within a restricted directory. The SSH client will not recognize private keys that are not kept in restricted directories. The key itself must also have restricted permissions (read and write only available for the owner). This means that other users on the system cannot snoop.<\/li><li>Any attacker hoping to crack the private SSH key passphrase must already have access to the system. This means that they will already have access to your user account or the root account. If you are in this position, the passphrase can prevent the attacker from immediately logging into your other servers. <\/li><\/ul>\n\n\n\n<p>A passphrase is an optional addition. If you enter one, you will have to provide it every time you use this key.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"332\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-219.png?resize=640%2C332&#038;ssl=1\" alt=\"\" class=\"wp-image-1340\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-219.png?w=797&amp;ssl=1 797w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-219.png?resize=300%2C155&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-219.png?resize=768%2C398&amp;ssl=1 768w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-219.png?resize=24%2C12&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-219.png?resize=36%2C19&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-219.png?resize=48%2C25&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<h3>2. Copy an SSH Public Key to Your Server<\/h3>\n\n\n\n<p>There are multiple ways to upload your public key to your remote SSH server. I&#8217;m going to show you three main used<\/p>\n\n\n\n<p><strong>Copying Your Public Key Using&nbsp;<code>ssh-copy-id<\/code><\/strong><\/p>\n\n\n\n<p>This tool should be preinstalled on every Red Hat 8 system and is the most used method to copy the keys over the network.<\/p>\n\n\n\n<p>To use it, you need to specify the server you are connecting\/copying the keys to<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">ssh-copy-id username@server_name<\/pre>\n<\/div><\/div>\n\n\n\n<figure class=\"wp-block-image size-full is-style-default\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"67\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-220.png?resize=640%2C67&#038;ssl=1\" alt=\"\" class=\"wp-image-1344\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-220.png?w=861&amp;ssl=1 861w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-220.png?resize=300%2C31&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-220.png?resize=768%2C80&amp;ssl=1 768w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-220.png?resize=24%2C3&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-220.png?resize=36%2C4&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-220.png?resize=48%2C5&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure>\n\n\n\n<p><\/p>\n\n\n\n<p>You will be promoted with more questions, including password authorization<\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"172\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-221.png?resize=640%2C172&#038;ssl=1\" alt=\"\" class=\"wp-image-1345\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-221.png?w=872&amp;ssl=1 872w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-221.png?resize=300%2C81&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-221.png?resize=768%2C206&amp;ssl=1 768w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-221.png?resize=24%2C6&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-221.png?resize=36%2C10&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-221.png?resize=48%2C13&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p>The ssh-copy-id will connect to the account on the remote host using the password you provided. It will then copy the contents of your&nbsp;<code>~\/.ssh\/id_rsa.pub<\/code>&nbsp;key into a file in the remote account\u2019s home&nbsp;<code>~\/.ssh<\/code>&nbsp;directory called&nbsp;<code>authorized_keys<\/code>.<\/p>\n\n\n\n<p><strong>Copying Your Public Key Using SSH<\/strong><\/p>\n\n\n\n<p>Another way of copying this key is using simple SSH connection. The command looks kinda scarry but all it does is create a folder and echo the content of your ~\/.ssh\/id_rsa.pub into the remote server.<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">cat ~\/.ssh\/id_rsa.pub | ssh <mark>username<\/mark>@<mark>remote_host<\/mark> \"mkdir -p ~\/.ssh &amp;&amp; cat &gt;&gt; ~\/.ssh\/authorized_keys\"<\/pre>\n<\/div><\/div>\n\n\n\n<p><strong>Copying Your Public Key Manually<\/strong><\/p>\n\n\n\n<p>And last but not least is the simplest method and that&#8217;s just copying the content of  ~\/.ssh\/id_rsa.pub and pasting it to the remote server.<\/p>\n\n\n\n<p>To display your&nbsp;<code>id_rsa.pub<\/code>&nbsp;key type<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-code\"><code>cat ~\/.ssh\/id_rsa.pub\n<\/code><\/pre>\n<\/div><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>You will see very long textile looking like this<\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"698\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-222.png?resize=640%2C698&#038;ssl=1\" alt=\"\" class=\"wp-image-1347\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-222.png?w=660&amp;ssl=1 660w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-222.png?resize=275%2C300&amp;ssl=1 275w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-222.png?resize=22%2C24&amp;ssl=1 22w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-222.png?resize=33%2C36&amp;ssl=1 33w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-222.png?resize=44%2C48&amp;ssl=1 44w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p>Which you then simply copy into another remote server&#8217;s \/.ssh\/authorized_keys<\/p>\n\n\n\n<p>First you need to create that directory<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">mkdir -p ~\/.ssh<\/pre>\n<\/div><\/div>\n\n\n\n<p>And then use any of your preferred methods to copy the context of our id_rsa text file. I&#8217;ll simple use ctrl+c\/ctrl+v.<\/p>\n\n\n\n<p>And that&#8217;s it.<\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"162\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/03\/image.png?resize=640%2C162&#038;ssl=1\" alt=\"\" class=\"wp-image-1349\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/03\/image.png?w=725&amp;ssl=1 725w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/03\/image.png?resize=300%2C76&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/03\/image.png?resize=24%2C6&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/03\/image.png?resize=36%2C9&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/03\/image.png?resize=48%2C12&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<h3>3.  Authenticate SSH keys<\/h3>\n\n\n\n<p>The last thing you need to do to complete the procedure is to connect to the remote server via SSH. <\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">ssh <mark>username<\/mark>@<mark>remote_host<\/mark><\/pre>\n<\/div><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>If you didn&#8217;t setup a passphrase for your private key, you will be logged in immediately. If youused a passphrase for the private key when you created the key, you will be required to enter it now. After this a new shell session will be created for you with the account on the remote system.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>OpenSSH server supports various authentication options. The two most popular are Passwords based authentication Public [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":1332,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"nf_dc_page":"","om_disable_all_campaigns":false,"_mi_skip_tracking":false},"categories":[219],"tags":[397,472,471,220,187],"jetpack_featured_media_url":"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/rhsa-Manage-security.png?fit=1280%2C720&ssl=1","_links":{"self":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/1335"}],"collection":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=1335"}],"version-history":[{"count":5,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/1335\/revisions"}],"predecessor-version":[{"id":1350,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/1335\/revisions\/1350"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/media\/1332"}],"wp:attachment":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=1335"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=1335"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=1335"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}