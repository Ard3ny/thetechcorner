{"id":1181,"date":"2022-02-16T16:41:00","date_gmt":"2022-02-16T16:41:00","guid":{"rendered":"https:\/\/thetechcorner.org\/?p=1181"},"modified":"2022-02-15T11:00:50","modified_gmt":"2022-02-15T11:00:50","slug":"configure-time-service-clients","status":"publish","type":"post","link":"https:\/\/thetechcorner.org\/?p=1181","title":{"rendered":"Configure time service clients"},"content":{"rendered":"\n<p><a href=\"https:\/\/docs.fedoraproject.org\/en-US\/Fedora\/24\/html\/System_Administrators_Guide\/ch-Configuring_NTP_Using_the_chrony_Suite.html\">According to Fedora documentation<\/a>, accurate time keeping is important for a number of reasons in IT. In networking for example, accurate time stamps in packets and logs are required. In Linux systems, the\u00a0<code>NTP<\/code>\u00a0protocol is implemented by a daemon running in user space.The user space daemon updates the system clock running in the kernel. The system clock can keep time by using various clock sources. Usually, the\u00a0<em>Time Stamp Counter<\/em>\u00a0(TSC) is used. The TSC is a CPU register which counts the number of cycles since it was last reset. It is very fast, has a high resolution, and there are no interrupts.There is a choice between the daemons\u00a0<code>ntpd<\/code>\u00a0and\u00a0<code>chronyd<\/code>, which are available from the repositories in the\u00a0<em>ntp<\/em>\u00a0and\u00a0<em>chrony<\/em>\u00a0packages respectively.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<p><strong>Chrony<\/strong>\u00a0consists of\u00a0<code>chronyd<\/code>, a daemon that runs in user space, and\u00a0<strong>chronyc<\/strong>, a command line program for making adjustments to\u00a0<code>chronyd<\/code>. Systems which are not permanently connected, or not permanently powered up, take a relatively long time to adjust their system clocks with\u00a0<code>ntpd<\/code>. This is because many small corrections are made based on observations of the clocks drift and offset. Temperature changes, which may be significant when powering up a system, affect the stability of hardware clocks. Although adjustments begin within a few milliseconds of booting a system, acceptable accuracy may take anything from ten seconds from a warm restart to a number of hours depending on your requirements, operating environment and hardware.\u00a0<strong>chrony<\/strong>\u00a0is a different implementation of the\u00a0<code>NTP<\/code>\u00a0protocol than\u00a0<code>ntpd<\/code>, it can adjust the system clock more rapidly.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<h3 id=\"differences-between-ntpd-and-chronyd\">Differences Between ntpd and chronyd<\/h3>\n\n\n\n<p>One of the main differences between&nbsp;<code>ntpd<\/code>&nbsp;and&nbsp;<code>chronyd<\/code>&nbsp;is in the algorithms used to control the computer&#8217;s clock. Things&nbsp;<code>chronyd<\/code>&nbsp;can do better than&nbsp;<code>ntpd<\/code>&nbsp;are:<\/p>\n\n\n\n<ul><li><code>chronyd<\/code>\u00a0can work well when external time references are only intermittently accessible, whereas\u00a0<code>ntpd<\/code>\u00a0needs regular polling of time reference to work well.<\/li><li><code>chronyd<\/code>\u00a0can perform well even when the network is congested for longer periods of time.<\/li><li><code>chronyd<\/code>\u00a0can usually synchronize the clock faster and with better time accuracy.<\/li><li><code>chronyd<\/code>\u00a0quickly adapts to sudden changes in the rate of the clock, for example, due to changes in the temperature of the crystal oscillator, whereas\u00a0<code>ntpd<\/code>\u00a0may need a long time to settle down again.<\/li><li>In the default configuration,\u00a0<code>chronyd<\/code>\u00a0never steps the time after the clock has been synchronized at system start, in order not to upset other running programs.\u00a0<code>ntpd<\/code>\u00a0can be configured to never step the time too, but it has to use a different means of adjusting the clock, which has some disadvantages.<\/li><li><code>chronyd<\/code>\u00a0can adjust the rate of the clock on a Linux system in a larger range, which allows it to operate even on machines with a broken or unstable clock. For example, on some virtual machines.<\/li><\/ul>\n\n\n\n<p><\/p>\n\n\n\n<blockquote class=\"wp-block-quote\"><p>Chrony is a default NTP client as well as an NTP server on\u00a0<a rel=\"noreferrer noopener\" href=\"https:\/\/linuxconfig.org\/how-to-install-rhel-8\" target=\"_blank\">RHEL 8<\/a>\u00a0\/ CentOS 8.<\/p><\/blockquote>\n\n\n\n<p><\/p>\n\n\n\n<h3 id=\"installing-chrony\">Installing Chrony<\/h3>\n\n\n\n<p>Chances are that chrony is already install on your RHEL or CENT 8 OS. But as always, you can use dnf or yum to install it<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">yum install chrony<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">systemctl enable chronyd --now<\/pre>\n<\/div><\/div>\n\n\n\n<h3 id=\"working-with-chrony\">Working with Chrony<\/h3>\n\n\n\n<p>First, let&#8217;s just check chrony is installed and running<\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-style-default\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"130\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-110.png?resize=640%2C130&#038;ssl=1\" alt=\"\" class=\"wp-image-1183\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-110.png?w=991&amp;ssl=1 991w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-110.png?resize=300%2C61&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-110.png?resize=768%2C156&amp;ssl=1 768w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-110.png?resize=24%2C5&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-110.png?resize=36%2C7&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-110.png?resize=48%2C10&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure>\n\n\n\n<p><\/p>\n\n\n\n<p>To check the sources if chrony, which are used to compare the time differences type<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">chronyc sources<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"135\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-111.png?resize=640%2C135&#038;ssl=1\" alt=\"\" class=\"wp-image-1184\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-111.png?w=731&amp;ssl=1 731w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-111.png?resize=300%2C63&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-111.png?resize=24%2C5&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-111.png?resize=36%2C8&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-111.png?resize=48%2C10&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>Chrony has also its own &#8220;shell environment&#8221; which we can access by command<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">chronyc<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"133\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-112.png?resize=640%2C133&#038;ssl=1\" alt=\"\" class=\"wp-image-1185\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-112.png?w=664&amp;ssl=1 664w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-112.png?resize=300%2C62&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-112.png?resize=24%2C5&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-112.png?resize=36%2C7&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-112.png?resize=48%2C10&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>By typing help, you&#8217;ll get a plenty of commands and options to play with<\/p>\n\n\n\n<p><\/p>\n\n\n\n<h3 id=\"configure-chrony\">Configure chrony<\/h3>\n\n\n\n<p>To configure chrony we need to edit the chrony config file inside the \/etc directory<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">sudo vi \/etc\/chrony.conf<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"250\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-113.png?resize=640%2C250&#038;ssl=1\" alt=\"\" class=\"wp-image-1186\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-113.png?w=772&amp;ssl=1 772w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-113.png?resize=300%2C117&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-113.png?resize=768%2C299&amp;ssl=1 768w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-113.png?resize=24%2C9&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-113.png?resize=36%2C14&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-113.png?resize=48%2C19&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>At the top of the text file, you can see the pool that is currently being used by chrony. But what is this pool?<\/p>\n\n\n\n<blockquote class=\"wp-block-quote\"><p>The\u00a0<strong>NTP pool<\/strong>\u00a0is a dynamic collection of networked\u00a0<a href=\"https:\/\/en.wikipedia.org\/wiki\/Computer\">computers<\/a>\u00a0that volunteer to provide highly accurate\u00a0<a href=\"https:\/\/en.wikipedia.org\/wiki\/Time\">time<\/a>\u00a0via the\u00a0<a href=\"https:\/\/en.wikipedia.org\/wiki\/Network_Time_Protocol\">Network Time Protocol<\/a>\u00a0to clients worldwide. The machines that are &#8220;in the pool&#8221; are part of the\u00a0<em>pool.ntp.org<\/em>\u00a0<a href=\"https:\/\/en.wikipedia.org\/wiki\/Domain_Name_System\">domain<\/a>\u00a0as well as of several\u00a0<a href=\"https:\/\/en.wikipedia.org\/wiki\/Subdomain\">subdomains<\/a>\u00a0divided by\u00a0<a href=\"https:\/\/en.wikipedia.org\/wiki\/Geographical_zone\">geographical zone<\/a>\u00a0and are distributed to NTP clients via\u00a0<a href=\"https:\/\/en.wikipedia.org\/wiki\/Round_robin_DNS\">round robin DNS<\/a><\/p><p><\/p><\/blockquote>\n\n\n\n<p><\/p>\n\n\n\n<p>So if you would want to add your own pool or pools or just the current one you would do so here. <\/p>\n\n\n\n<p><\/p>\n\n\n\n<p>Next, restart the Chrony service to apply the changes:<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">systemctl restart chronyd<\/pre>\n<\/div><\/div>\n\n\n\n<p><\/p>\n\n\n\n<h3 id=\"configure-firewall\">Configure Firewall<\/h3>\n\n\n\n<p>Next, you will need to allow NTP service through the firewall. You can allow it with the following command:<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --permanent --add-service=ntp --permanent<\/pre>\n<\/div><\/div>\n\n\n\n<p>Next, reload the firewall service to apply the changes:<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --reload<\/pre>\n<\/div><\/div>\n\n\n\n<p><\/p>\n\n\n\n<h3 id=\"changing-time-timezone\">Changing time \/ timezone<\/h3>\n\n\n\n<p>To display current time and date of the system type<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">timedatectl<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"524\" height=\"169\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-114.png?resize=524%2C169&#038;ssl=1\" alt=\"\" class=\"wp-image-1187\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-114.png?w=524&amp;ssl=1 524w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-114.png?resize=300%2C97&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-114.png?resize=24%2C8&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-114.png?resize=36%2C12&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-114.png?resize=48%2C15&amp;ssl=1 48w\" sizes=\"(max-width: 524px) 100vw, 524px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>Time should be automatically changed according to the timezone, to change the timezone use this command<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">timedatectl set-timezone *name_of_time_zone*<\/pre>\n<\/div><\/div>\n\n\n\n<p>There are around 400 possible timezones to choose from, so if you are not sure which one is your. You can use another utility called tzselect which will guide you through the configuration process.<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">tzselect<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"248\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-115.png?resize=640%2C248&#038;ssl=1\" alt=\"\" class=\"wp-image-1188\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-115.png?w=718&amp;ssl=1 718w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-115.png?resize=300%2C116&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-115.png?resize=24%2C9&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-115.png?resize=36%2C14&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-115.png?resize=48%2C19&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n","protected":false},"excerpt":{"rendered":"<p>According to Fedora documentation, accurate time keeping is important for a number of reasons in [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":1174,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"nf_dc_page":"","om_disable_all_campaigns":false,"_mi_skip_tracking":false},"categories":[219],"tags":[424,425,426,428,220,359,427],"jetpack_featured_media_url":"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/rhsa-Deploy-configure-and-maintain-systems-1.png?fit=1280%2C720&ssl=1","_links":{"self":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/1181"}],"collection":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=1181"}],"version-history":[{"count":1,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/1181\/revisions"}],"predecessor-version":[{"id":1189,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/1181\/revisions\/1189"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/media\/1174"}],"wp:attachment":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=1181"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=1181"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=1181"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}