{"id":880,"date":"2022-01-24T17:17:00","date_gmt":"2022-01-24T17:17:00","guid":{"rendered":"https:\/\/thetechcorner.org\/?p=880"},"modified":"2022-01-23T13:54:41","modified_gmt":"2022-01-23T13:54:41","slug":"adjust-process-scheduling","status":"publish","type":"post","link":"https:\/\/thetechcorner.org\/?p=880","title":{"rendered":"Adjust process scheduling"},"content":{"rendered":"\n<blockquote class=\"wp-block-quote\"><p><a href=\"https:\/\/www.informit.com\/articles\/article.aspx?p=101760\">The scheduler<\/a> is the component of the kernel that selects which process to run next. The scheduler (or process scheduler, as it is sometimes called) can be viewed as the code that divides the finite resource of processor time between the runnable processes on a system. The scheduler is the basis of a multitasking operating system such as Linux. By deciding what process can run, the scheduler is responsible for best utilizing the system and giving the impression that multiple processes are simultaneously executing.<\/p><p>The idea behind the scheduler is simple. To best utilize processor time, assuming there are runnable processes, a process should always be running.<\/p><\/blockquote>\n\n\n\n<p><\/p>\n\n\n\n<p>One of the tools we use to adjust processes is &#8220;<strong>chrt<\/strong>&#8220;<\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"209\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-164.png?resize=640%2C209&#038;ssl=1\" alt=\"\" class=\"wp-image-882\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-164.png?w=729&amp;ssl=1 729w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-164.png?resize=300%2C98&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-164.png?resize=24%2C8&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-164.png?resize=36%2C12&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-164.png?resize=48%2C16&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">chrt --help<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"556\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-165.png?resize=640%2C556&#038;ssl=1\" alt=\"\" class=\"wp-image-883\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-165.png?w=706&amp;ssl=1 706w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-165.png?resize=300%2C260&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-165.png?resize=24%2C21&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-165.png?resize=36%2C31&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-165.png?resize=48%2C42&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>To demonstrate this in real life, let&#8217;s do an example. We will install apache server so we can work on something. In CentOS the package is called httpd and we use yum package manager to download it.<\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"272\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-166.png?resize=640%2C272&#038;ssl=1\" alt=\"\" class=\"wp-image-885\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-166.png?w=732&amp;ssl=1 732w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-166.png?resize=300%2C127&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-166.png?resize=24%2C10&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-166.png?resize=36%2C15&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-166.png?resize=48%2C20&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<blockquote class=\"wp-block-quote\"><p>Note: You need to have internet connection and network card enabled.<\/p><\/blockquote>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full is-resized\"><img decoding=\"async\" loading=\"lazy\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-167.png?resize=499%2C353&#038;ssl=1\" alt=\"\" class=\"wp-image-886\" width=\"499\" height=\"353\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-167.png?w=964&amp;ssl=1 964w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-167.png?resize=300%2C213&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-167.png?resize=768%2C545&amp;ssl=1 768w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-167.png?resize=24%2C17&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-167.png?resize=36%2C26&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-167.png?resize=48%2C34&amp;ssl=1 48w\" sizes=\"(max-width: 499px) 100vw, 499px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p> <\/p>\n\n\n\n<p><\/p>\n\n\n\n<p>Now we simply start the httpd server<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">service httpd start<\/pre>\n\n\n\n<pre class=\"wp-block-preformatted\">service httpd status<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"302\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-168.png?resize=640%2C302&#038;ssl=1\" alt=\"\" class=\"wp-image-888\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-168.png?w=731&amp;ssl=1 731w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-168.png?resize=300%2C142&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-168.png?resize=24%2C11&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-168.png?resize=36%2C17&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-168.png?resize=48%2C23&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>Because we need PID of the processes we want to adjust, let&#8217;s list those out.<\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-style-default\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"111\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-169.png?resize=640%2C111&#038;ssl=1\" alt=\"\" class=\"wp-image-890\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-169.png?w=888&amp;ssl=1 888w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-169.png?resize=300%2C52&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-169.png?resize=768%2C133&amp;ssl=1 768w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-169.png?resize=24%2C4&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-169.png?resize=36%2C6&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-169.png?resize=48%2C8&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure>\n\n\n\n<p><\/p>\n\n\n\n<p>Finally, we can use chrt utility, we can either use it one by one on every process or make little script to do so.<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">for i in $(pgrep httpd); do chrt -p $i; done<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"229\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-170.png?resize=640%2C229&#038;ssl=1\" alt=\"\" class=\"wp-image-891\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-170.png?w=672&amp;ssl=1 672w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-170.png?resize=300%2C107&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-170.png?resize=24%2C9&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-170.png?resize=36%2C13&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-170.png?resize=48%2C17&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>There are many policy options we can set in chrt, but I think one is enough to showcase this. But this option is not persistent and It will NOT service the reboot or service restart.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<h3>Permanent change that survives the reboot<\/h3>\n\n\n\n<p>For this we use \/usr\/lib\/systemd\/system which has all of our services configurations. We simply edit our httpd.service configuration file.<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">vim \/usr\/lib\/systemd\/system\/httpd.service<\/pre>\n<\/div><\/div>\n\n\n\n<p>And we add these lines under [Service] category.<\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"278\" height=\"124\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-171.png?resize=278%2C124&#038;ssl=1\" alt=\"\" class=\"wp-image-892\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-171.png?w=278&amp;ssl=1 278w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-171.png?resize=24%2C11&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-171.png?resize=36%2C16&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-171.png?resize=48%2C21&amp;ssl=1 48w\" sizes=\"(max-width: 278px) 100vw, 278px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<h3>What those lines means?<\/h3>\n\n\n\n<p><strong>CPUSchedulingPolicy<\/strong><\/p>\n\n\n\n<p>Linux supports 3 scheduling policies: SCHED_FIFO, SCHED_RR, and SCHED_OTHER. SCHED_OTHER is the default universal time-sharing scheduler policy used by most processes; SCHED_FIFO and SCHED_RR are intended for special time-critical applications that need precise control over the way in which runnable processes are selected for execution.<\/p>\n\n\n\n<p>A static priority value is assigned to each process and scheduling depends on this static priority. Processes scheduled with SCHED_OTHER have static priority 0; processes scheduled under SCHED_FIFO or SCHED_RR can have a static priority in the range 1 to 99.<\/p>\n\n\n\n<p>All scheduling is preemptive: If a process with a higher static priority gets ready to run, the current process will be preempted and returned to its wait list. The scheduling policy only determines the ordering within the list of runnable processes with equal static priority.<\/p>\n\n\n\n<p>There is a single run-queue. The scheduler goes through each process in the queue and selects the task with the highest static priority. In case of SCHED_OTHER, each task may be assigned a priority or &#8220;niceness&#8221; which will determine how long a time-slice it gets. The &#8220;counter&#8221; attribute of each task determines how much time it has left in its time-slice. The scheduler selects the task with highest counter value as the next task to run. After every task on the run-queue has used up its time-slice (counter = 0), the counter for each task is set to the original priority + half the counter. In this way &#8220;interactive tasks&#8221; (tasks which were not in run-queue but whose counter was not zero) get a priority boost.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<p><strong>CPUSchedulingPriority <\/strong><\/p>\n\n\n\n<p>In the man page od &#8220;sched&#8221; command you can find that, it&#8217;s set what&#8217;s called nice value which I&#8217;ll explain in a minute.<\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-style-default\"><img decoding=\"async\" loading=\"lazy\" width=\"582\" height=\"79\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-172.png?resize=582%2C79&#038;ssl=1\" alt=\"\" class=\"wp-image-893\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-172.png?w=582&amp;ssl=1 582w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-172.png?resize=300%2C41&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-172.png?resize=24%2C3&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-172.png?resize=36%2C5&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-172.png?resize=48%2C7&amp;ssl=1 48w\" sizes=\"(max-width: 582px) 100vw, 582px\" data-recalc-dims=\"1\" \/><\/figure>\n\n\n\n<p><\/p>\n\n\n\n<h3>Understanding Process Priority and Nice Value<\/h3>\n\n\n\n<p>he kernel stores a great deal of information about processes including process priority which is simply the scheduling priority attached to a process. Processes with a higher priority will be executed before those with a lower priority, while processes with the same priority are scheduled one after the next, repeatedly.<\/p>\n\n\n\n<p>There are a total of\u00a0<strong>140<\/strong>\u00a0priorities and two distinct priority ranges implemented in Linux. The first one is a nice value (<strong>niceness<\/strong>) which ranges from\u00a0<code>-20<\/code>\u00a0(highest priority value) to\u00a0<code>19<\/code>\u00a0(lowest priority value) and the default is\u00a0<code>0<\/code>, this is what we will uncover in this guide. The other is the real-time priority, which ranges from\u00a0<strong>1<\/strong>\u00a0to\u00a0<strong>99<\/strong>\u00a0by default, then\u00a0<strong>100<\/strong>\u00a0to\u00a0<strong>139<\/strong>\u00a0are meant for user-space.<\/p>\n\n\n\n<p>You can check the niceness of process in all monitoring tools like: top, ps, htop.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<p><strong>How to use this?<\/strong><\/p>\n\n\n\n<p>\u00a0If you have a very CPU-intensive program or task, but you also understand that it might take a long time to complete, you can set it a high or favorable priority using the\u00a0<strong>nice command<\/strong>.<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">nice -n niceness-value [*process*] <\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"587\" height=\"50\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-173.png?resize=587%2C50&#038;ssl=1\" alt=\"\" class=\"wp-image-894\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-173.png?w=587&amp;ssl=1 587w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-173.png?resize=300%2C26&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-173.png?resize=24%2C2&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-173.png?resize=36%2C3&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-173.png?resize=48%2C4&amp;ssl=1 48w\" sizes=\"(max-width: 587px) 100vw, 587px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>We can also change the already running level of niceness by<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">renice -n  5 -u httpd<\/pre>\n<\/div><\/div>\n\n\n\n<p>or<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">renice -n  5 -p *PID*<\/pre>\n<\/div><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p><\/p>\n","protected":false},"excerpt":{"rendered":"<p>The scheduler is the component of the kernel that selects which process to run next. [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":840,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"nf_dc_page":"","om_disable_all_campaigns":false,"_mi_skip_tracking":false},"categories":[219],"tags":[337,338,340,342,341,339],"jetpack_featured_media_url":"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/rhsa-operate-running-systems.png?fit=1280%2C720&ssl=1","_links":{"self":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/880"}],"collection":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=880"}],"version-history":[{"count":5,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/880\/revisions"}],"predecessor-version":[{"id":895,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/880\/revisions\/895"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/media\/840"}],"wp:attachment":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=880"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=880"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=880"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}