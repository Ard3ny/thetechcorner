{"id":1250,"date":"2022-02-23T17:21:00","date_gmt":"2022-02-23T17:21:00","guid":{"rendered":"https:\/\/thetechcorner.org\/?p=1250"},"modified":"2022-02-21T11:27:04","modified_gmt":"2022-02-21T11:27:04","slug":"restrict-network-access-using-firewall-cmd-firewall","status":"publish","type":"post","link":"https:\/\/thetechcorner.org\/?p=1250","title":{"rendered":"Restrict network access using firewall-cmd\/firewall"},"content":{"rendered":"\n<h2 id=\"the-firewall\">The firewall<\/h2>\n\n\n\n<p>A firewall is a set of rules. When a data packet moves into or out of a protected network space, its contents (in particular, information about its origin, target, and the protocol it plans to use) are tested against the firewall rules to see if it should be allowed through<\/p>\n\n\n\n<p>We can manage firewall with firewall-cmd administrative tool.<\/p>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full is-resized\"><img decoding=\"async\" loading=\"lazy\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/pngegg.png?w=640&#038;ssl=1\" alt=\"\" class=\"wp-image-1258\" width=\"-481\" height=\"-481\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/pngegg.png?w=800&amp;ssl=1 800w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/pngegg.png?resize=300%2C300&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/pngegg.png?resize=150%2C150&amp;ssl=1 150w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/pngegg.png?resize=768%2C768&amp;ssl=1 768w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/pngegg.png?resize=24%2C24&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/pngegg.png?resize=36%2C36&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/pngegg.png?resize=48%2C48&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><strong>Before I start talking about the actual commands, it would be good to know a few things first<\/strong><\/p>\n\n\n\n<h3 id=\"zones\"><strong>Zones<\/strong><\/h3>\n\n\n\n<p>The\u00a0<code>firewalld<\/code>\u00a0daemon manages groups of rules using entities called \u201czones\u201d. Zones are basically sets of rules dictating what traffic should be allowed depending on the level of trust you have in the networks your computer is connected to. You may have strict rules in place prohibiting most traffic when operating on a public WiFi network, while allowing more relaxed restrictions when connected to your home network.\u00a0<\/p>\n\n\n\n<p>Regardless of how dynamic your network environment may be, it is still useful to be familiar with the general idea behind each of the predefined zones for&nbsp;<code>firewalld<\/code>. In order from&nbsp;<strong>least trusted<\/strong>&nbsp;to&nbsp;<strong>most trusted<\/strong>, the predefined zones within&nbsp;<code>firewalld<\/code>&nbsp;are:<\/p>\n\n\n\n<ul><li><strong>drop<\/strong>: The lowest level of trust. All incoming connections are dropped without reply and only outgoing connections are possible.<\/li><li><strong>block<\/strong>: Similar to the above, but instead of simply dropping connections, incoming requests are rejected with an\u00a0<code>icmp-host-prohibited<\/code>\u00a0or\u00a0<code>icmp6-adm-prohibited<\/code>\u00a0message.<\/li><li><strong>public<\/strong>: Represents public, untrusted networks. You don\u2019t trust other computers but may allow selected incoming connections on a case-by-case basis.<\/li><li><strong>external<\/strong>: External networks in the event that you are using the firewall as your gateway. It is configured for NAT masquerading so that your internal network remains private but reachable.<\/li><li><strong>internal<\/strong>: The other side of the external zone, used for the internal portion of a gateway. The computers are fairly trustworthy and some additional services are available.<\/li><li><strong>dmz<\/strong>: Used for computers located in a DMZ (isolated computers that will not have access to the rest of your network). Only certain incoming connections are allowed.<\/li><li><strong>work<\/strong>: Used for work machines. Trust most of the computers in the network. A few more services might be allowed.<\/li><li><strong>home<\/strong>: A home environment. It generally implies that you trust most of the other computers and that a few more services will be accepted.<\/li><li><strong>trusted<\/strong>: Trust all of the machines in the network. The most open of the available options and should be used sparingly.<\/li><\/ul>\n\n\n\n<p><\/p>\n\n\n\n<h3 id=\"rule-permanence\"><strong>Rule Permanence<\/strong><\/h3>\n\n\n\n<p>In firewalld, rules can be designated as either permanent or immediate. If a rule is added or modified, by default, the behavior of the currently running firewall is modified. At the next boot, the modifications will be thrown out and the old rules will be applied.<\/p>\n\n\n\n<p>Most\u00a0<code>firewall-cmd<\/code>\u00a0operations can take the\u00a0<code>--permanent<\/code>\u00a0flag to indicate that the non-ephemeral firewall should be targeted. This will affect the rule set that is reloaded upon boot<\/p>\n\n\n\n<p><\/p>\n\n\n\n<h3 id=\"working-with-firewall\"><strong>Working with firewall<\/strong><\/h3>\n\n\n\n<p><strong>To get a zone, which is currently running on our system<\/strong><\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --get-active-zone<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"74\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-164.png?resize=640%2C74&#038;ssl=1\" alt=\"\" class=\"wp-image-1259\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-164.png?w=727&amp;ssl=1 727w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-164.png?resize=300%2C35&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-164.png?resize=24%2C3&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-164.png?resize=36%2C4&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-164.png?resize=48%2C6&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><strong>To get a zone, which is currently default on our system<\/strong><\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --get-default-zone<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"53\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-171.png?resize=640%2C53&#038;ssl=1\" alt=\"\" class=\"wp-image-1267\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-171.png?w=737&amp;ssl=1 737w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-171.png?resize=300%2C25&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-171.png?resize=24%2C2&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-171.png?resize=36%2C3&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-171.png?resize=48%2C4&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><strong>To get all the information about current active zone<\/strong><\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --list-all --zone=public<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"267\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-165.png?resize=640%2C267&#038;ssl=1\" alt=\"\" class=\"wp-image-1260\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-165.png?w=702&amp;ssl=1 702w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-165.png?resize=300%2C125&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-165.png?resize=24%2C10&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-165.png?resize=36%2C15&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-165.png?resize=48%2C20&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p>You can notice a lot of information, but I&#8217;m going to point out the service category, which is listing all currently allowed service traffic.<\/p>\n\n\n\n<p><\/p>\n\n\n\n<p><strong>Removing the service from firewall<\/strong> <strong>whitelist<\/strong><\/p>\n\n\n\n<p>To remove service or rather I say to restrict the traffic we can simply remove the service<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --remove-service=nfs --pernament<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"54\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-167.png?resize=640%2C54&#038;ssl=1\" alt=\"\" class=\"wp-image-1262\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-167.png?w=714&amp;ssl=1 714w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-167.png?resize=300%2C25&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-167.png?resize=24%2C2&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-167.png?resize=36%2C3&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-167.png?resize=48%2C4&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p>To apply the change, we need to reload the settings or service<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --reload<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"273\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-168.png?resize=640%2C273&#038;ssl=1\" alt=\"\" class=\"wp-image-1263\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-168.png?w=682&amp;ssl=1 682w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-168.png?resize=300%2C128&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-168.png?resize=24%2C10&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-168.png?resize=36%2C15&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-168.png?resize=48%2C20&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p><strong>Adding the service to firewall whitelist<\/strong><\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --add-service=nfs --pernament<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --reload<\/pre>\n<\/div><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p><strong>Changing the firewall zone<\/strong><\/p>\n\n\n\n<p>The default firewall zone we currently have is the &#8220;public&#8221;, but we can change this by typing<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">firewall-cmd --change-interface=*inteface_name* --zone=home<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"50\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-169.png?resize=640%2C50&#038;ssl=1\" alt=\"\" class=\"wp-image-1265\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-169.png?w=716&amp;ssl=1 716w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-169.png?resize=300%2C23&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-169.png?resize=24%2C2&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-169.png?resize=36%2C3&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-169.png?resize=48%2C4&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"251\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-170.png?resize=640%2C251&#038;ssl=1\" alt=\"\" class=\"wp-image-1266\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-170.png?w=738&amp;ssl=1 738w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-170.png?resize=300%2C117&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-170.png?resize=24%2C9&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-170.png?resize=36%2C14&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-170.png?resize=48%2C19&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p><strong>Changing the firewall default zone<\/strong><\/p>\n\n\n\n<p>If all of your interfaces can be handled well by a single zone, it\u2019s probably easiest to just designate the best zone as default and then use that for your configuration.<\/p>\n\n\n\n<p>You can change the default zone with the&nbsp;<code>--set-default-zone=<\/code>&nbsp;parameter. This will immediately change any interface using the default zone:<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-code\"><code>firewall-cmd --set-default-zone=home<\/code><\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"75\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-172.png?resize=640%2C75&#038;ssl=1\" alt=\"\" class=\"wp-image-1268\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-172.png?w=733&amp;ssl=1 733w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-172.png?resize=300%2C35&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-172.png?resize=24%2C3&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-172.png?resize=36%2C4&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/image-172.png?resize=48%2C6&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n","protected":false},"excerpt":{"rendered":"<p>The firewall A firewall is a set of rules. When a data packet moves into [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":1246,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"nf_dc_page":"","om_disable_all_campaigns":false,"_mi_skip_tracking":false},"categories":[219],"tags":[456,98,453,454,391,220,455],"jetpack_featured_media_url":"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/02\/rhsa-Manage-basic-networking.png?fit=1280%2C720&ssl=1","_links":{"self":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/1250"}],"collection":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=1250"}],"version-history":[{"count":2,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/1250\/revisions"}],"predecessor-version":[{"id":1269,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/1250\/revisions\/1269"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/media\/1246"}],"wp:attachment":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=1250"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=1250"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=1250"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}