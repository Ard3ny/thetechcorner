{"id":918,"date":"2022-01-27T17:00:00","date_gmt":"2022-01-27T17:00:00","guid":{"rendered":"https:\/\/thetechcorner.org\/?p=918"},"modified":"2022-01-24T16:03:08","modified_gmt":"2022-01-24T16:03:08","slug":"preserve-system-journals","status":"publish","type":"post","link":"https:\/\/thetechcorner.org\/?p=918","title":{"rendered":"Preserve system journals"},"content":{"rendered":"\n<p>As I&#8217;ve mentioned in a previous post, system journals doesn&#8217;t survive reboot. Often this is not what we want, so I&#8217;ll show you a simple solution to deal with this.<\/p>\n\n\n\n<p>First we need to change journald.conf and check what storage parameter we have set:<\/p>\n\n\n\n<p><\/p>\n\n\n\n<blockquote class=\"wp-block-quote\"><p>The Storage parameter in the \/etc\/systemd\/journald.conf \ufb01le de\ufb01nes whether to store system journals in a volatile manner or persistently across reboot. Set this parameter to\u00a0<strong>persistent<\/strong>,\u00a0<strong>volatile<\/strong>, or\u00a0<strong>auto<\/strong>\u00a0as follows:<\/p><\/blockquote>\n\n\n\n<ul><li><strong>persistent<\/strong>: stores journals in the \/var\/log\/journal directory which persists across reboots. If the \/var\/log\/journal directory does not exist, the systemd-journald service creates it.<\/li><li><strong>volatile<\/strong>: stores journals in the volatile \/run\/log\/journal directory. As the \/run \ufb01le system is temporary and exists only in the runtime memory, data stored in it, including system journals, do not persist across reboot.<\/li><li><strong>auto<\/strong>: rsyslog determines whether to use persistent or volatile storage. If the \/var\/log\/ journal directory exists, then rsyslog uses persistent storage, otherwise it uses volatile storage.<\/li><\/ul>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">less \/etc\/systemd\/journald.conf<\/pre>\n<\/div><\/div>\n\n\n\n<div class=\"wp-block-image is-style-default\"><figure class=\"aligncenter size-full\"><img decoding=\"async\" loading=\"lazy\" width=\"270\" height=\"147\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-188.png?resize=270%2C147&#038;ssl=1\" alt=\"\" class=\"wp-image-929\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-188.png?w=270&amp;ssl=1 270w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-188.png?resize=24%2C13&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-188.png?resize=36%2C20&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-188.png?resize=48%2C26&amp;ssl=1 48w\" sizes=\"(max-width: 270px) 100vw, 270px\" data-recalc-dims=\"1\" \/><\/figure><\/div>\n\n\n\n<p><strong>As we can see our storage option is set to auto which means we need to either create \/var\/log\/journal directory or set this option to &#8220;persistent&#8221;.<\/strong><\/p>\n\n\n\n<p><\/p>\n\n\n\n<p>Let&#8217;s try creating the directory option:<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">mkdir \/var\/log\/journal<\/pre>\n<\/div><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>After creating file, let&#8217;s restart the service and reboot the OS to see if it&#8217;s working<\/p>\n\n\n\n<div class=\"is-layout-flow wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<pre class=\"wp-block-preformatted\">systemctl restart systemd-journald\nshutdown -r now<\/pre>\n<\/div><\/div>\n\n\n\n<p><\/p>\n\n\n\n<p>After reboot list the directory \/var\/log\/journal<\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-style-default\"><img decoding=\"async\" loading=\"lazy\" width=\"640\" height=\"80\" src=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-189.png?resize=640%2C80&#038;ssl=1\" alt=\"\" class=\"wp-image-930\" srcset=\"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-189.png?w=779&amp;ssl=1 779w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-189.png?resize=300%2C37&amp;ssl=1 300w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-189.png?resize=768%2C96&amp;ssl=1 768w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-189.png?resize=24%2C3&amp;ssl=1 24w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-189.png?resize=36%2C4&amp;ssl=1 36w, https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/image-189.png?resize=48%2C6&amp;ssl=1 48w\" sizes=\"(max-width: 640px) 100vw, 640px\" data-recalc-dims=\"1\" \/><\/figure>\n\n\n\n<p><\/p>\n\n\n\n<p>And as you can see, we have a new file there, which means old journal files before reboot were stored here.<\/p>\n\n\n\n<p><\/p>\n","protected":false},"excerpt":{"rendered":"<p>As I&#8217;ve mentioned in a previous post, system journals doesn&#8217;t survive reboot. Often this is [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":840,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"nf_dc_page":"","om_disable_all_campaigns":false,"_mi_skip_tracking":false},"categories":[219],"tags":[352,349,351,314,220],"jetpack_featured_media_url":"https:\/\/i0.wp.com\/thetechcorner.org\/wp-content\/uploads\/2022\/01\/rhsa-operate-running-systems.png?fit=1280%2C720&ssl=1","_links":{"self":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/918"}],"collection":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=918"}],"version-history":[{"count":1,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/918\/revisions"}],"predecessor-version":[{"id":931,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/posts\/918\/revisions\/931"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=\/wp\/v2\/media\/840"}],"wp:attachment":[{"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=918"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=918"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/thetechcorner.org\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=918"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}